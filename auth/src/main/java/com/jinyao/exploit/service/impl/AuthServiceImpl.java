package com.jinyao.exploit.service.impl;

import com.jinyao.exploit.common.enums.ResponseCode;
import com.jinyao.exploit.dao.AuthDao;
import com.jinyao.exploit.service.AuthService;
import com.jinyao.exploit.common.base.BaseUser;
import com.jinyao.exploit.common.base.entity.BaseResult;
import com.jinyao.exploit.common.base.service.impl.CrudServiceImpl;
import com.jinyao.exploit.common.utils.JwtUtils;
import com.jinyao.exploit.common.utils.UserUtils;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

/**
 * 文件说明
 * tm 2019/8/24 15:29
 */
@Service
@Transactional(readOnly = true)
public class AuthServiceImpl extends CrudServiceImpl<AuthDao, BaseUser> implements AuthService {

    /**
     * 登录，如果登录成功则生成token到返回信息
     * @param loginName
     * @param password
     * @return
     */
    @Override
    public BaseResult login(String loginName, String password) {
        BaseResult baseResult = null;
        if(loginName != null){
            // 根据用户名获取用户
            BaseUser user = dao.selectOne(new BaseUser(loginName).getWrapper());
            // 如果该用户名有用户，则继续验证密码
            if(user != null){
                // 验证密码
                if(user.getPassword().equals(UserUtils.passwordEncryption(password))){
                    // 验证通过，生成token
                    baseResult = BaseResult.result(JwtUtils.getToken(user.getId()));
                }
            }
        }
        return baseResult == null ? BaseResult.result(ResponseCode.CODE_411) : baseResult;
    }

}
