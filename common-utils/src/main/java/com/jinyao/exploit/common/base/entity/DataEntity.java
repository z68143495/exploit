package com.jinyao.exploit.common.base.entity;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableLogic;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.toolkit.Wrappers;
import com.fasterxml.jackson.annotation.JsonIgnore;
import com.jinyao.exploit.common.utils.IdGen;
import com.jinyao.exploit.common.utils.UserUtils;
import jdk.nashorn.internal.ir.annotations.Ignore;
import lombok.Data;

import java.util.Date;

/***********************************************************************
 * 文件说明：用于数据库实体
 * 创建信息：李晋 2018-10-9 15:24
 * 变更履历： 
 ***********************************************************************/
@Data
//@JsonInclude(JsonInclude.Include.NON_NULL)
public class DataEntity<T> extends BaseEntity<T> {

  /**
   * 删除标记（0：正常；1：删除）
   */
  public static final String IS_DELETE_FALSE = "0";
  public static final String IS_DELETE_TRUE = "1";

  private Long createBy;  // 创建者
  private Date createDate;  // 创建日期
  private Long updateBy;  // 更新者
  private Date updateDate;  // 更新日期
  private String remarks;   // 备注
  @TableLogic
  private String isDelete;   // 删除标记

  public DataEntity() {
    super();
    this.isDelete = "0";
  }

  public DataEntity(long id) {
    super(id);
    this.isDelete = "0";
  }

  @TableField(exist = false)
  private boolean newRecord = false;

  public boolean isNewRecord(){
    return newRecord || id == null;
  }

  public void preInsert(){
    if(id == null){
      setId(IdGen.sfId());
    }
    createBy = UserUtils.getUserId();
    createDate = new Date();
    updateBy = UserUtils.getUserId();
    updateDate = new Date();
  }

  public void preUpdate(){
    createBy = UserUtils.getUserId();
    createDate = new Date();
    updateBy = UserUtils.getUserId();
    updateDate = new Date();
  }

  /**
   * 获取当前对象的QueryWrapper<T>
   * @return
   */
  @JsonIgnore
  public QueryWrapper<T> getWrapper(){
    return (QueryWrapper<T>) Wrappers.query(this);
  }
}
