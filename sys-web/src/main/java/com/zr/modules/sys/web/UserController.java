package com.zr.modules.sys.web;

import com.zr.entity.BaseResult;
import com.zr.entity.LayuiResult;
import com.zr.model.sys.Office;
import com.zr.model.sys.User;
import com.zr.modules.sys.dao.IOfficeDao;
import com.zr.modules.sys.dao.IUserDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.Arrays;
import java.util.List;

/***********************************************************************
 * 文件说明：用户表（sys_user）视图层控制器
 * 创建信息：李晋 2019-01-18 14-51-58
 * 变更履历： 
 ***********************************************************************/
@Controller
@RequestMapping(value = "${adminPath}/sys/user")
public class UserController {

    private String modules = "sys/user/";

    @Autowired
    private IUserDao userService;
    @Autowired
    private IOfficeDao officeService;

    @RequestMapping(value = {"list", ""})
    public String list() {
        return modules + "list";
    }

    @RequestMapping(value = "listData")
    @ResponseBody
    public LayuiResult listData(User user) {
        List userList = (List) userService.list(user).getData();
        return new LayuiResult(userList);
    }

    @RequestMapping(value = "form")
    public String form(User user, Model model) {
//        BaseResult result = userService.get(user);
//        user = (User) result.getData();
//        model.addAttribute("user", user);
        model.addAttribute("user", userService.get(user).getData());
        List officeList = (List) officeService.get(new Office()).getData();
        model.addAttribute("officeList", officeList);
        return modules + "form";
    }

    @RequestMapping(value = "save")
    @ResponseBody
    public LayuiResult save(User user) {
        userService.save(user);
        return new LayuiResult();
    }

    @RequestMapping(value = "delete")
    @ResponseBody
    public LayuiResult delete(String id) {
        userService.delete(id);
        return new LayuiResult();
    }

    @RequestMapping(value = "batchDelete")
    @ResponseBody
    public LayuiResult batchDelete(String ids) {
        String[] idss = ids.split(",");
        List<String> idList = Arrays.asList(idss);
        userService.batchDelete(idList);
        return new LayuiResult();
    }

}